--source include/have_rocksdb.inc

# Issue221
# Turning on both --rocksdb-allow-mmap-reads and --rocksdb-use-direct-reads
# caused an assertion in RocksDB.  Now it should not be allowed and the
# server will not start with that configuration

--let SEARCH_FILE=$MYSQLTEST_VARDIR/tmp/rocksdb.use_direct_reads_writes.err

--source include/shutdown_mysqld.inc

# Expect server crash on startup with invalid combination of arguments
# Attempt to restart the server with invalid options
--error 1
--exec $MYSQLD --log-error=$SEARCH_FILE --rocksdb_use_direct_reads=1 --rocksdb_allow_mmap_reads=1

# We should now have an error message
--let SEARCH_PATTERN=enable both use_direct_reads
--source include/search_pattern_in_file.inc
--remove_file $SEARCH_FILE

# Repeat with --rocksdb-use-direct-writes
# Attempt to restart the server with invalid options
--error 1
--exec $MYSQLD --log-error=$SEARCH_FILE --rocksdb_use_direct_io_for_flush_and_compaction=1 --rocksdb_allow_mmap_writes=1

# We should now have an error message
--let SEARCH_PATTERN=enable both use_direct_io_for_flush_and_compaction
--source include/search_pattern_in_file.inc
--remove_file $SEARCH_FILE

--let $restart_parameters=
--source include/start_mysqld.inc

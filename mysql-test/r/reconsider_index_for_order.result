CREATE TABLE `t` (
`id`                  BIGINT        NOT NULL,
`other_id`            BIGINT        NOT NULL,
`covered_column`      VARCHAR(50)   NOT NULL,
`non_covered_column`  VARCHAR(50)   NOT NULL,
PRIMARY KEY (`id`),
INDEX `index_other_id_covered_column` (`other_id`, `covered_column`)
);
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (10, 10 % 1000, '10', '10');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (9, 9 % 1000, '9', '9');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (8, 8 % 1000, '8', '8');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (7, 7 % 1000, '7', '7');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (6, 6 % 1000, '6', '6');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (5, 5 % 1000, '5', '5');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (4, 4 % 1000, '4', '4');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (3, 3 % 1000, '3', '3');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (2, 2 % 1000, '2', '2');
INSERT INTO t (id, other_id, covered_column, non_covered_column) VALUES (1, 1 % 1000, '1', '1');
SET
optimizer_trace = "enabled=on",
optimizer_trace_max_mem_size = 1000000,
end_markers_in_json = ON;
SELECT `non_covered_column` FROM `t` WHERE `other_id` = 555 ORDER BY `id` ASC LIMIT 2;
non_covered_column
SELECT (trace LIKE '%reconsidering_access_paths_for_index_ordering%') AS should_be_1 FROM information_schema.optimizer_trace;
should_be_1
1
SELECT * FROM `t` WHERE `other_id` = 555 AND `id` IN (1, 2, 3) ORDER BY `id` DESC;
id	other_id	covered_column	non_covered_column
SELECT (trace LIKE '%reconsidering_access_paths_for_index_ordering%') AS should_be_1 FROM information_schema.optimizer_trace;
should_be_1
1
SET optimizer_switch = "reconsider_index_for_order=off";
SELECT `non_covered_column` FROM `t` WHERE `other_id` = 555 ORDER BY `id` ASC LIMIT 2;
non_covered_column
SELECT (trace LIKE '%reconsidering_access_paths_for_index_ordering%') AS should_be_0 FROM information_schema.optimizer_trace;
should_be_0
0
SELECT * FROM `t` WHERE `other_id` = 555 AND `id` IN (1, 2, 3) ORDER BY `id` DESC;
id	other_id	covered_column	non_covered_column
SELECT (trace LIKE '%reconsidering_access_paths_for_index_ordering%') AS should_be_0 FROM information_schema.optimizer_trace;
should_be_0
0
SET optimizer_switch = default;
SELECT `non_covered_column` FROM `t` WHERE `other_id` = 555 ORDER BY `id` ASC LIMIT 2;
non_covered_column
SELECT (trace LIKE '%reconsidering_access_paths_for_index_ordering%') AS should_be_1 FROM information_schema.optimizer_trace;
should_be_1
1
SELECT * FROM `t` WHERE `other_id` = 555 AND `id` IN (1, 2, 3) ORDER BY `id` DESC;
id	other_id	covered_column	non_covered_column
SELECT (trace LIKE '%reconsidering_access_paths_for_index_ordering%') AS should_be_1 FROM information_schema.optimizer_trace;
should_be_1
1
DROP TABLE t;
